<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>المستفيدين من طرود رمضان</title>
    <meta property="og:title" content="فحص بيانات المستفيدين - طرود رمضان">
    <meta property="og:description" content="البحث عن بيانات المستفيدين">
    <meta property="og:image" content="https://gazasoupkitchen.org/wp-content/uploads/2025/08/1-3-1024x199.png">
    <style>
        :root {
            --primary-color: #1a5f7a;
            --secondary-color: #ffd700;
            --bg-color: #f4f7f9;
            --card-bg: #ffffff;
            --text-main: #333333;
            --text-muted: #666666;
            --error-color: #d9534f;
            --success-color: #5cb85c;
            --border-radius: 12px;
            --transition: all 0.3s ease;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, sans-serif; }
        body { background-color: var(--bg-color); color: var(--text-main); display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px; }
        .container { width: 100%; max-width: 600px; background: var(--card-bg); padding: 30px; border-radius: var(--border-radius); box-shadow: 0 10px 25px rgba(0,0,0,0.05); text-align: center; }
        .header { margin-bottom: 30px; }
        h1 { font-size: 1.5rem; color: var(--primary-color); margin-bottom: 5px; }
        p.subtitle { font-size: 0.9rem; color: var(--text-muted); }
        .form-group { margin-bottom: 20px; text-align: right; }
        label { display: block; margin-bottom: 8px; font-weight: 600; color: var(--primary-color); }
        input, select { width: 100%; padding: 12px 15px; border: 2px solid #e1e1e1; border-radius: var(--border-radius); font-size: 1rem; outline: none; transition: var(--transition); }
        input:focus, select:focus { border-color: var(--primary-color); }
        .btn { width: 100%; padding: 14px; border: none; border-radius: var(--border-radius); font-size: 1.1rem; font-weight: bold; cursor: pointer; transition: var(--transition); margin-top: 10px; }
        .btn-primary { background-color: var(--primary-color); color: white; }
        .btn-outline { background-color: transparent; border: 2px solid var(--primary-color); color: var(--primary-color); margin-top: 5px; }
        .view { display: none; animation: fadeIn 0.4s ease forwards; }
        .view.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid var(--primary-color); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .table-container { overflow-x: auto; margin-top: 20px; border-radius: 8px; border: 1px solid #eee; }
        table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
        th { background-color: var(--primary-color); color: white; padding: 12px; text-align: right; }
        td { padding: 12px; border-bottom: 1px solid #eee; text-align: right; }
        .alert { padding: 15px; border-radius: var(--border-radius); margin-bottom: 20px; }
        .alert-error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <img style="max-width:100px; max-height:auto;" src="https://gazakitchen.github.io/logogaza.png">
            <h1>طرود رمضان</h1>
            <p class="subtitle">نظام فحص بيانات المستفيدين</p>
        </div>
        <div id="search-view" class="view active">
            <div class="form-group">
                <label for="id-input">آخر 4 أرقام من هوية الزوج</label>
                <input type="number" id="id-input" placeholder="" pattern="\d{4}">
            </div>
            <div class="form-group">
                <label for="location-select">الموقع</label>
                <select id="location-select"><option value="">-- اختر المنطقة --</option></select>
            </div>
            <button class="btn btn-primary" onclick="performSearch()">بـحـث</button>
        </div>
        <div id="loading-view" class="view"><div class="loader"></div><p>جاري جلب البيانات والتحقق...</p></div>
        <div id="results-view" class="view"><div id="results-content"></div><button class="btn btn-outline" onclick="showView('search-view')">بحث جديد</button></div>
        <div id="no-results-view" class="view"><div class="alert alert-error">لم يتم العثور على نتائج تطابق البيانات المدخلة</div><button class="btn btn-primary" onclick="showView('search-view')">العودة للبحث</button></div>
    </div>

<script>
    let rawData = [];
    async function load() {
        try {
            const r = await fetch('data.json');
            const j = await r.json();
            const bin = atob(j.payload);
            const bytes = new Uint8Array(bin.length);
            for(let i=0; i<bin.length; i++) bytes[i] = bin.charCodeAt(i);
            const ds = new DecompressionStream('deflate');
            const writer = ds.writable.getWriter();
            writer.write(bytes); writer.close();
            const out = await new Response(ds.readable).arrayBuffer();
            rawData = JSON.parse(new TextDecoder().decode(out));
            const locs = [...new Set(rawData.map(d => d.LOCATION))];
            const sel = document.getElementById('location-select');
            locs.forEach(l => { if(l){ const o = document.createElement('option'); o.value = o.text = l; sel.add(o); } });
        } catch(e) { console.error(e); }
    }

    function showView(viewId) {
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        document.getElementById(viewId).classList.add('active');
    }

    function performSearch() {
        const idInput = document.getElementById('id-input').value.trim();
        const locSelect = document.getElementById('location-select').value;
        if (!idInput || idInput.length < 4 || !locSelect) { alert("يرجى إدخال البيانات بشكل صحيح"); return; }
        showView('loading-view');
        setTimeout(() => {
            const res = rawData.filter(d => String(d.ID).endsWith(idInput) && d.LOCATION === locSelect);
            if (res.length > 0) { renderResults(res); showView('results-view'); } 
            else { showView('no-results-view'); }
        }, 600);
    }

    function renderResults(results) {
        const container = document.getElementById('results-content');
        let html = `
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>اسم العائلة</th>
                            <th>عدد الأفراد</th>
                            <th>هوية الزوج (آخر 4 ارقام)</th>
                            <th>الموقع</th>
                        </tr>
                    </thead>
                    <tbody>
        `;
        results.forEach(item => {
            html += `
                <tr>
                    <td><strong>${item.NAME || ''}</strong></td>
                    <td>${item.FAMILY || ''}</td>
                    <td>${item.ID}</td>
                    <td><small>${item.LOCATION}</small></td>
                </tr>
            `;
        });
        html += `</tbody></table></div><p style="margin-top: 15px; font-size: 0.8rem; color: #5cb85c;">تم العثور على ${results.length} نتيجة</p>`;
        container.innerHTML = html;
    }
    load();
</script>
<img style="display: none;" src="https://bit.ly/gazakitchenlinks">
</body>
</html>