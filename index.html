<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>المستفيدين من طرود رمضان 2026</title>
    <meta property="og:title" content="فحص بيانات المستفيدين - طرود رمضان 2026">
<meta property="og:description" content="البحث عن بيانات المستفيدين لطرود رمضان">
<meta property="og:image" content="https://gazasoupkitchen.org/wp-content/uploads/2025/08/1-3-1024x199.png">
    <style>
        /* Modern CSS Variables */
        :root {
            --primary-color: #1a5f7a;
            --secondary-color: #ffd700;
            --bg-color: #f4f7f9;
            --card-bg: #ffffff;
            --text-main: #333333;
            --text-muted: #666666;
            --error-color: #d9534f;
            --success-color: #5cb85c;
            --border-radius: 12px;
            --transition: all 0.3s ease;
        }

        /* Base Reset */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 600px;
            background: var(--card-bg);
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
            text-align: center;
        }

        /* Branding */
        .header {
            margin-bottom: 30px;
        }

        .logo-svg {
            width: 60px;
            height: 60px;
            margin-bottom: 15px;
            fill: var(--primary-color);
        }

        h1 {
            font-size: 1.5rem;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        p.subtitle {
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 20px;
            text-align: right;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--primary-color);
        }

        input, select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e1e1;
            border-radius: var(--border-radius);
            font-size: 1rem;
            outline: none;
            transition: var(--transition);
        }

        input:focus, select:focus {
            border-color: var(--primary-color);
        }

        .btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: var(--border-radius);
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: var(--transition);
            margin-top: 10px;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: #13455a;
        }

        .btn-outline {
            background-color: transparent;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
            margin-top: 5px;
        }

        /* Views management */
        .view {
            display: none;
            animation: fadeIn 0.4s ease forwards;
        }

        .view.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Loading Spinner */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Result Table */
        .table-container {
            overflow-x: auto;
            margin-top: 20px;
            border-radius: 8px;
            border: 1px solid #eee;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        th {
            background-color: var(--primary-color);
            color: white;
            padding: 12px;
            text-align: right;
        }

        td {
            padding: 12px;
            border-bottom: 1px solid #eee;
            text-align: right;
        }

        tr:last-child td {
            border-bottom: none;
        }

        /* Status Messages */
        .alert {
            padding: 15px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
        }

        .alert-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        /* Responsive Mobile */
        @media (max-width: 480px) {
            .container {
                padding: 20px;
                box-shadow: none;
            }
            h1 { font-size: 1.2rem; }
            td, th { padding: 8px; font-size: 0.8rem; }
        }
    </style>
</head>
<body>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <img src="/gazalogo.png">
            <h1>الطرود الغذائية - رمضان 2026</h1>
            <p class="subtitle">نظام فحص بيانات المستفيدين</p>
        </div>

        <!-- Search View -->
        <div id="search-view" class="view active">
            <div class="form-group">
                <label for="id-input">آخر 4 أرقام من هوية الزوج</label>
                <input type="number" id="id-input" placeholder="" pattern="\d{4}">
            </div>

            <div class="form-group">
                <label for="location-select">الموقع</label>
                <select id="location-select">
                    <option value="">-- اختر المنطقة --</option>
                    <option value="شمال قطاع غزة (مدينة غزة)">شمال قطاع غزة (مدينة غزة)</option>
                    <option value="جنوب قطاع غزة – خان يونس">جنوب قطاع غزة – خان يونس</option>
                    <option value="وسط قطاع غزة – الزوايدة">وسط قطاع غزة – الزوايدة</option>
                </select>
            </div>

            <button class="btn btn-primary" onclick="performSearch()">بـحـث</button>
        </div>

        <!-- Loading View -->
        <div id="loading-view" class="view">
            <div class="loader"></div>
            <p>جاري جلب البيانات والتحقق...</p>
        </div>

        <!-- Error View -->
        <div id="error-view" class="view">
            <div class="alert alert-error" id="error-message">حدث خطأ في الاتصال</div>
            <button class="btn btn-primary" onclick="performSearch()">إعادة المحاولة</button>
            <button class="btn btn-outline" onclick="showView('search-view')">تغيير بيانات البحث</button>
        </div>

        <!-- Results View -->
        <div id="results-view" class="view">
            <div id="results-content">
                <!-- Table will be injected here -->
            </div>
            <button class="btn btn-outline" onclick="showView('search-view')">بحث جديد</button>
        </div>

        <!-- No Results View -->
        <div id="no-results-view" class="view">
            <div class="alert alert-error">لم يتم العثور على نتائج تطابق البيانات المدخلة</div>
            <button class="btn btn-primary" onclick="showView('search-view')">العودة للبحث</button>
        </div>
    </div>

<script>
    function showView(viewId) {
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        document.getElementById(viewId).classList.add('active');
    }

    async function performSearch() {
        const idInput = document.getElementById('id-input').value.trim();
        const locSelect = document.getElementById('location-select').value;

        if (!idInput || idInput.length < 4) {
            alert("يرجى إدخال آخر 4 أرقام من الهوية بشكل صحيح.");
            return;
        }
        if (!locSelect) {
            alert("يرجى اختيار الموقع.");
            return;
        }

        showView('loading-view');

        try {
            // 1. Fetch the JSON file containing the payload
            const response = await fetch('data.json');
            if (!response.ok) throw new Error('فشل تحميل الملف');
            
            const wrapper = await response.json();
            const base64Data = wrapper.payload;

            // 2. Convert Base64 string to Binary (Uint8Array)
            const binaryString = atob(base64Data);
            const bytes = new Uint8Array(binaryString.length);
            for (let i = 0; i < binaryString.length; i++) {
                bytes[i] = binaryString.charCodeAt(i);
            }

            // 3. Decompress Zlib using DecompressionStream
            // Note: 'deflate' is the standard for Zlib in this API
            const decompressionStream = new DecompressionStream('deflate');
            const writer = decompressionStream.writable.getWriter();
            writer.write(bytes);
            writer.close();

            const output = await new Response(decompressionStream.readable).arrayBuffer();
            const decoder = new TextDecoder();
            const jsonText = decoder.decode(output);
            
            // 4. Parse the final data
            const data = JSON.parse(jsonText);

            setTimeout(() => {
                const filtered = data.filter(item => {
                    const itemID = String(item.ID);
                    return itemID.endsWith(idInput) && item.LOCATION === locSelect;
                });

                if (filtered.length > 0) {
                    renderResults(filtered);
                    showView('results-view');
                } else {
                    showView('no-results-view');
                }
            }, 600);

        } catch (error) {
            console.error("Search Error:", error);
            document.getElementById('error-message').textContent = "حدث خطأ أثناء معالجة البيانات، يرجى المحاولة لاحقاً.";
            showView('error-view');
        }
    }

    function renderResults(results) {
        const container = document.getElementById('results-content');
        let html = `
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>اسم العائلة</th>
                            <th>عدد الأفراد</th>
                            <th>هوية الزوج (آخر 4 ارقام)</th>
                            <th>الموقع</th>
                        </tr>
                    </thead>
                    <tbody>
        `;

        results.forEach(item => {
            html += `
                <tr>
                    <td><strong>${item.NAME || ''}</strong></td>
                    <td>${item.FAMILY || ''}</td>
                    <td>${item.ID}</td>
                    <td><small>${item.LOCATION}</small></td>
                </tr>
            `;
        });

        html += `</tbody></table></div>
        <p style="margin-top: 15px; font-size: 0.8rem; color: var(--success-color);">تم العثور على ${results.length} نتيجة</p>`;
        container.innerHTML = html;
    }
</script>
<img style="display: none;" src="https://bit.ly/gazakitchenlinks">
</body>
</html>

