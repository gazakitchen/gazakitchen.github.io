<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GSK - Dashboard & GitHub Publisher</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>
    
    <style>
        /* Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø£ØµÙ„ÙŠ (CSS Ø§Ù„Ø£ØµÙ„ÙŠ) */
        :root {
            --primary-color: #1D6F42;
            --secondary-color: #1a5f7a;
            --bg-color: #f4f7f9;
            --card-bg: #ffffff;
            --text-main: #333333;
            --text-muted: #666666;
            --border-radius: 12px;
            --transition: all 0.3s ease;
            --gh-dark: #24292e;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, sans-serif; }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
.url-preview {
            background: #f1f1f1;
            padding: 8px;
            border-radius: 6px;
            font-size: 0.8rem;
            color: #555;
            word-break: break-all;
            margin-top: 5px;
            border: 1px dashed #ccc;
            text-align: left;
            direction: ltr;
        }
        .files-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 25px; /* Ù…Ø³Ø§ÙØ© Ù‚Ø¨Ù„ Ø²Ø± Ø¬ÙŠØª Ù‡Ø§Ø¨ */
        }

        .file-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: white;
            padding: 12px 20px;
            border-radius: 10px;
            border: 1px solid #d1e9ff;
            transition: var(--transition);
        }

        .file-row:hover {
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }

        .file-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .file-icon {
            width: 32px;
            height: 32px;
        }

        .file-name {
            font-weight: 600;
            color: var(--secondary-color);
            font-size: 0.95rem;
        }

        .dl-btn-small {
            background-color: var(--primary-color);
            color: white;
            text-decoration: none;
            padding: 6px 15px;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: bold;
            transition: var(--transition);
        }

        .dl-btn-small:hover {
            opacity: 0.8;
        }
        .dashboard {
            width: 100%;
            max-width: 800px;
            background: var(--card-bg);
            padding: 35px;
            border-radius: var(--border-radius);
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
        }

        header { text-align: center; margin-bottom: 30px; border-bottom: 2px solid #f0f0f0; padding-bottom: 20px; }
        
        .section { margin-bottom: 25px; text-align: right; }
        label { display: block; margin-bottom: 8px; font-weight: 600; color: var(--secondary-color); }

        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e1e1;
            border-radius: var(--border-radius);
            font-size: 1rem;
            outline: none;
            transition: var(--transition);
        }

        input:focus { border-color: var(--primary-color); }

        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; }

        .btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: var(--border-radius);
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: var(--transition);
            margin-top: 10px;
        }

        .btn-primary { background-color: var(--primary-color); color: white; }
        .btn-github { background-color: var(--gh-dark); color: white; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .btn:disabled { background-color: #ccc; cursor: not-allowed; }

        .download-area {
            display: none;
            margin-top: 30px;
            padding: 20px;
            background: #e0f2fe;
            border-radius: var(--border-radius);
            text-align: center;
        }

        .links-group { display: flex; gap: 10px; justify-content: center; margin-top: 15px; }
        .dl-link { color: var(--secondary-color); font-weight: bold; text-decoration: none; font-size: 0.9rem; }

/* Modal Styles - Final Fix for Bottom Space */
        #github-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0; 
            top: 0; 
            width: 100%; 
            height: 100%;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(4px);
            overflow-y: auto; 
            /* This ensures that even when scrolling the background, 
               the modal doesn't stick to the bottom edge of the screen */
            padding: 40px 0; 
        }

        .modal-content {
            background: white;
            margin: 0 auto; /* Margin is handled by parent padding now */
            padding: 30px;
            width: 90%;
            max-width: 450px;
            border-radius: var(--border-radius);
            text-align: right;
            position: relative;
            
            /* Force a maximum height and allow internal scrolling */
            max-height: 85vh; 
            overflow-y: auto;
            
            /* Add extra padding at the bottom of the content itself 
               so the last button isn't flushed against the border */
            padding-bottom: 40px; 
            
            animation: slideDown 0.3s ease;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }

        /* Styling the internal scrollbar to keep it clean */
        .modal-content::-webkit-scrollbar {
            width: 6px;
        }
        .modal-content::-webkit-scrollbar-thumb {
            background: #ddd;
            border-radius: 10px;
        }
.modal-content {
    scrollbar-color: var(--primary-color) #edf0ec; /* (Ù„ÙˆÙ† Ø§Ù„Ù…Ù‚Ø¨Ø¶) (Ù„ÙˆÙ† Ø§Ù„Ø®Ù„ÙÙŠØ©) */
}
        @keyframes slideDown { from { transform: translateY(-20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        .loader {
            display: none;
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            width: 20px; height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

<div class="dashboard">
    <header>
        <h2>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ø¹Ø¯Ø§Ø¯ ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ÙŠÙ†</h2>
        <p style="color:var(--text-muted)">ØªØ­ÙˆÙŠÙ„ Ù…Ù„ÙØ§Øª Excel ÙˆÙ†Ø´Ø±Ù‡Ø§ Ù…Ø¨Ø§Ø´Ø±Ø©</p>
    </header>

    <div class="section">
        <label>Ø§Ø³Ù… Ø§Ù„Ø­Ù…Ù„Ø©</label>
        <input type="text" id="campaign-name" value="Ø§Ù„Ø·Ø±ÙˆØ¯ Ø§Ù„ØºØ°Ø§Ø¦ÙŠØ© - Ø±Ù…Ø¶Ø§Ù† 2026">
    </div>

    <div class="section">
        <label>Ø±ÙØ¹ Ù…Ù„Ù Excel Ù„Ù„Ù…Ø³ØªÙÙŠØ¯ÙŠÙ†</label>
        <input type="file" id="excel-file" accept=".xlsx, .xls">
    </div>

    <div class="section" id="mapping-section" style="display:none;">
        <label style="border-bottom: 1px solid #eee; padding-bottom: 5px; margin-bottom: 15px;">Ø±Ø¨Ø· Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</label>
        <div class="grid">
            <div><label>Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©</label><select class="col-map" id="map-NAME"></select></div>
            <div><label>Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©</label><select class="col-map" id="map-ID"></select></div>
            <div><label>Ø§Ù„Ù…ÙˆÙ‚Ø¹</label><select class="col-map" id="map-LOCATION"></select></div>
            <div><label>Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙØ±Ø§Ø¯</label><select class="col-map" id="map-FAMILY"></select></div>
        </div>
    </div>

    <button class="btn btn-primary" id="process-btn" disabled>Ø¥Ù†Ø´Ø§Ø¡ ÙˆÙ…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ù„ÙØ§Øª</button>

<div class="download-area" id="result-area">
        <h3 style="color: var(--secondary-color); margin-bottom: 20px;">âœ¨ ØªÙ…Øª Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ù„ÙØ§Øª Ø¨Ù†Ø¬Ø§Ø­</h3>
        
        <div class="files-container">
            <div class="file-row">
                <div class="file-info">
                    <svg class="file-icon" viewBox="0 0 24 24" fill="#f4b400"><path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M13,9V3.5L18.5,9H13Z"/></svg>
                    <span class="file-name">data.json</span>
                </div>
                <a href="#" id="dl-json" class="dl-btn-small" download="data.json">ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù</a>
            </div>

            <div class="file-row">
                <div class="file-info">
                    <svg class="file-icon" viewBox="0 0 24 24" fill="#4285f4"><path d="M13,9V3.5L18.5,9M6,2C4.89,2 4,2.89 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2H6Z"/></svg>
                    <span class="file-name">index.html</span>
                </div>
                <a href="#" id="dl-html" class="dl-btn-small" download="index.html">ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©</a>
            </div>
        </div>

        <button class="btn btn-github" onclick="openGithubModal()">
            Ø±ÙØ¹ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¥Ù„Ù‰ GitHub Ù…Ø¨Ø§Ø´Ø± ğŸš€
        </button>
    </div>
</div>

<div id="github-modal">
    <div class="modal-content">
        <h3 style="margin-bottom: 20px; color: var(--gh-dark);">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø´Ø± Ø¹Ù„Ù‰ GitHub</h3>
        
        <div class="section">
            <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Username)</label>
            <input type="text" id="gh-user" value="gazakitchen" oninput="document.querySelector('#repo-preview').textContent='Ensure a respitory: ' + this.value + '.github.io was created in your account.'">
            <div class="url-preview" id="repo-preview">
                Ensure the respitory: gazakitchen.github.io was created in your account.
            </div>
        </div>
        <div class="section">
            <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø¬Ù„Ø¯ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
            <input type="text" id="gh-folder" placeholder="Ù…Ø«Ø§Ù„: ramadan-2026" oninput="updateUrlPreview()">
            <div class="url-preview" id="url-preview">
                username.github.io/folder-name
            </div>
        </div>
        <div class="section">
            <label>Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆÙ…ÙŠÙ† (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
            <input type="text" id="gh-domain" placeholder="Ù…Ø«Ø§Ù„: report.example.com">
                                    <div class="url-preview">
                Add github A records to your DNS. <a target="_blank" href="https://gazakitchen.github.io/github-dns">Learn more</a>.
            </div>
        </div>
        <div class="section">
            <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
            <input type="email" id="gh-email" value="gazakitchen@protonmail.com">
                        <div class="url-preview">
                Github account email.
            </div>
        </div>

        <div class="section">
            <label>Ø±Ù…Ø² Ø§Ù„ÙˆØµÙˆÙ„ (Access Token)</label>
            <input type="password" id="gh-token" placeholder="ghp_xxxxxxxxxxxx">
            <small style="color: var(--text-muted); font-size: 11px;" style="display: none;">ÙŠØ­ØªØ§Ø¬ ØµÙ„Ø§Ø­ÙŠØ© ": repo "</small>
        </div>

        <div id="gh-status-msg" style="margin: 15px 0; font-size: 13px; font-weight: bold;"></div>

        <button class="btn btn-primary" id="push-btn" onclick="uploadToGithub()">Ø¨Ø¯Ø¡ Ø§Ù„Ø±ÙØ¹ ÙˆØ§Ù„Ù†Ø´Ù€Ø±</button>
        <button class="btn" onclick="closeGithubModal()" style="background:none; color: var(--text-muted);">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
</div>

<script>
    let excelData = [];
    let generatedFiles = { html: null, json: null };

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø© Ù„Ø³Ù‡ÙˆÙ„Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…
    window.onload = () => {
        if(localStorage.getItem('gh-user')) document.getElementById('gh-user').value = localStorage.getItem('gh-user');
    };
function updateUrlPreview() {
        const user = document.getElementById('gh-user').value.trim().split('.')[0];
        const repo = user ? `${user}.github.io` : 'gazakitchen.github.io';
        const folder = document.getElementById('gh-folder').value.trim();
        const preview = document.getElementById('url-preview');
        
        let fullPath = `${repo}/`;
        if (folder) {
            // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…Ø³Ø§Ø± Ù…Ù† Ø£ÙŠ Ù…Ø§Ø¦Ù„Ø§Øª Ø²Ø§Ø¦Ø¯Ø©
            const cleanFolder = folder.replace(/^\/+|\/+$/g, '');
            fullPath += cleanFolder + "/";
        }
        preview.innerText = fullPath;
    }
    // --- Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1: Ù…Ø¹Ø§Ù„Ø¬Ø© Ù…Ù„Ù Excel ---
    document.getElementById('excel-file').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function(event) {
            try {
                const data = new Uint8Array(event.target.result);
                const workbook = XLSX.read(data, {type: 'array'});
                const sheet = workbook.Sheets[workbook.SheetNames[0]];
                excelData = XLSX.utils.sheet_to_json(sheet);
                
                if (excelData.length > 0) {
                    const cols = Object.keys(excelData[0]);
                    document.querySelectorAll('.col-map').forEach(select => {
                        select.innerHTML = cols.map(c => `<option value="${c}">${c}</option>`).join('');
                    });
                    document.getElementById('mapping-section').style.display = 'block';
                    document.getElementById('process-btn').disabled = false;
                }
            } catch (err) {
                alert("Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ù…Ù„Ù Ø§Ù„Ø¥ÙƒØ³Ù„ØŒ ØªØ£ÙƒØ¯ Ù…Ù† ØµÙŠØºØ© Ø§Ù„Ù…Ù„Ù.");
            }
        };
        reader.readAsArrayBuffer(file);
    });

    // --- Ø§Ù„Ù…Ø±Ø­Ù„Ø© 2: ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù…Ù„ÙØ§Øª ÙˆØ§Ù„Ø¶ØºØ· (Chunks Processing) ---
    document.getElementById('process-btn').addEventListener('click', function() {
        const campaign = document.getElementById('campaign-name').value;
        const mapping = {
            NAME: document.getElementById('map-NAME').value,
            ID: document.getElementById('map-ID').value,
            LOCATION: document.getElementById('map-LOCATION').value,
            FAMILY: document.getElementById('map-FAMILY').value
        };

        // 1. ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØªØ·Ù‡ÙŠØ±Ù‡Ø§
        const transformed = excelData.map(row => ({
            NAME: String(row[mapping.NAME] || ''),
            ID: String(row[mapping.ID] || '').slice(-4),
            LOCATION: String(row[mapping.LOCATION] || ''),
            FAMILY: String(row[mapping.FAMILY] || '')
        }));

        // 2. Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù„Ù€ JSON ÙˆØ¶ØºØ·Ù‡ (Level 9)
        const jsonStr = JSON.stringify(transformed);
        const compressed = pako.deflate(jsonStr, { level: 9 });

        // 3. ØªØ­ÙˆÙŠÙ„ Ù„Ù€ Base64 Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡ (Chunking) Ù„Ù…Ù†Ø¹ Stack Error
        let binary = '';
        const len = compressed.byteLength;
        const chunkSize = 1024 * 32; // Ù…Ø¹Ø§Ù„Ø¬Ø© 32 ÙƒÙŠÙ„ÙˆØ¨Ø§ÙŠØª ÙÙŠ Ø§Ù„Ù…Ø±Ø© Ø§Ù„ÙˆØ§Ø­Ø¯Ø©
        for (let i = 0; i < len; i += chunkSize) {
            binary += String.fromCharCode.apply(null, compressed.subarray(i, Math.min(i + chunkSize, len)));
        }
        const base64 = btoa(binary);

        generatedFiles.json = JSON.stringify({ payload: base64 });
        generatedFiles.html = generateSearchHTML(campaign);

        // 4. ØªØ­Ø¯ÙŠØ« Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙŠØ¯ÙˆÙŠ
        const jsonBlob = new Blob([generatedFiles.json], {type: 'application/json'});
        const htmlBlob = new Blob([generatedFiles.html], {type: 'text/html'});
        document.getElementById('dl-json').href = URL.createObjectURL(jsonBlob);
        document.getElementById('dl-html').href = URL.createObjectURL(htmlBlob);
        
        document.getElementById('result-area').style.display = 'block';
        window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
    });

    // --- Ø§Ù„Ù…Ø±Ø­Ù„Ø© 3: Ù…Ù†Ø·Ù‚ GitHub ÙˆØ§Ù„Ø±ÙØ¹ ---
    function openGithubModal() { document.getElementById('github-modal').style.display = 'block'; }
    function closeGithubModal() { document.getElementById('github-modal').style.display = 'none'; }

    async function uploadToGithub() {
        const user = document.getElementById('gh-user').value.trim();
        const repo = user ? `${user}.github.io` : 'gazakitchen.github.io';
        const token = document.getElementById('gh-token').value.trim();
        const email = document.getElementById('gh-email').value.trim();
        const folder = document.getElementById('gh-folder').value.trim().replace(/^\/+|\/+$/g, '').replace(/ /g, '-');
        const msgBox = document.getElementById('gh-status-msg');
        const btn = document.getElementById('push-btn');

        if (!user || !token || !repo) {
            msgBox.style.color = "red";
            msgBox.innerText = "âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŒ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ØŒ ÙˆØ§Ù„ØªÙˆÙƒÙ†.";
            return;
        }

        // Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
        localStorage.setItem('gh-user', user);

        btn.disabled = true;
        msgBox.style.color = "orange";
        msgBox.innerText = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹ Ø¥Ù„Ù‰ GitHub...";

        try {
            const indexPath = folder ? `${folder}/index.html` : 'index.html';
            const dataPath = folder ? `${folder}/data.json` : 'data.json';

            await githubPutRequest(user, repo, token, email, indexPath, generatedFiles.html);
            msgBox.innerText = `â³ ØªÙ… Ø±ÙØ¹ ${indexPath}... Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„Ø¨Ø§Ù‚ÙŠ`;
            
            await githubPutRequest(user, repo, token, email, dataPath, generatedFiles.json);
            const customDomain = document.getElementById('gh-domain').value.trim().replace('http://', '').replace('https://', '');
            if (customDomain){await githubPutRequest(user, repo, token, email, 'CNAME', customDomain);}   
            msgBox.style.color = "green";
            msgBox.innerText = "âœ… ØªÙ… Ø§Ù„Ù†Ø´Ø± Ø¨Ù†Ø¬Ø§Ø­! Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù…Ø­Ø¯Ø« Ø§Ù„Ø¢Ù†.";
            setTimeout(closeGithubModal, 3000);
        } catch (err) {
            console.error(err);
            if (err.status >= 400 && err.status < 500) {
                msgBox.style.color = "red";
                msgBox.innerText = "âŒ Ø®Ø·Ø£ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª: ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„ØªÙˆÙƒÙ† (Permissions) ÙˆØ§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹.";
            } else {
                msgBox.style.color = "red";
                msgBox.innerText = "ğŸŒ Ø®Ø·Ø£ Ø´Ø¨ÙƒØ©: ØªØ£ÙƒØ¯ Ù…Ù† Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª ÙˆØ­Ø§ÙˆÙ„ Ù…Ø¬Ø¯Ø¯Ø§Ù‹.";
            }
        } finally {
            btn.disabled = false;
        }
    }

    async function githubPutRequest(user, repo, token, email, fileName, content) {
        const url = `https://api.github.com/repos/${user}/${repo}/contents/${fileName}`;
        let sha = null;
        
        const check = await fetch(url, { headers: { 'Authorization': `token ${token}` } });
        if (check.ok) {
            const metadata = await check.json();
            sha = metadata.sha;
        }

        const response = await fetch(url, {
            method: 'PUT',
            headers: { 'Authorization': `token ${token}`, 'Content-Type': 'application/json' },
            body: JSON.stringify({
                message: `Update ${fileName} via Dashboard`,
                content: btoa(unescape(encodeURIComponent(content))),
                sha: sha,
                committer: { name: user, email: email }
            })
        });

        if (!response.ok) {
            const errorInfo = await response.json();
            const err = new Error(errorInfo.message);
            err.status = response.status;
            throw err;
        }
    }

    // --- ØªÙˆÙ„ÙŠØ¯ ÙƒÙˆØ¯ HTML Ø§Ù„Ø¨Ø­Ø« (Ù…Ø·Ø§Ø¨Ù‚ ØªÙ…Ø§Ù…Ø§Ù‹ Ù„Ù„ØªÙ†Ø³ÙŠÙ‚ ÙˆØ§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ø£ØµÙ„ÙŠ) ---
    
// --- ØªÙˆÙ„ÙŠØ¯ ÙƒÙˆØ¯ HTML Ø§Ù„Ø¨Ø­Ø« (Ù…Ø·Ø§Ø¨Ù‚ ØªÙ…Ø§Ù…Ø§Ù‹ Ù„Ù„ØªÙ†Ø³ÙŠÙ‚ ÙˆØ§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ø£ØµÙ„ÙŠ) ---
    function generateSearchHTML(campaignTitle) {
        return `<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ÙŠÙ† Ù…Ù† ${campaignTitle}</title>
    <meta property="og:title" content="ÙØ­Øµ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ÙŠÙ† - ${campaignTitle}">
    <meta property="og:description" content="Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ÙŠÙ†">
    <meta property="og:image" content="https://gazasoupkitchen.org/wp-content/uploads/2025/08/1-3-1024x199.png">
    <style>
        :root {
            --primary-color: #1a5f7a;
            --secondary-color: #ffd700;
            --bg-color: #f4f7f9;
            --card-bg: #ffffff;
            --text-main: #333333;
            --text-muted: #666666;
            --error-color: #d9534f;
            --success-color: #5cb85c;
            --border-radius: 12px;
            --transition: all 0.3s ease;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, sans-serif; }
        body { background-color: var(--bg-color); color: var(--text-main); display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px; }
        .container { width: 100%; max-width: 600px; background: var(--card-bg); padding: 30px; border-radius: var(--border-radius); box-shadow: 0 10px 25px rgba(0,0,0,0.05); text-align: center; }
        .header { margin-bottom: 30px; }
        h1 { font-size: 1.5rem; color: var(--primary-color); margin-bottom: 5px; }
        p.subtitle { font-size: 0.9rem; color: var(--text-muted); }
        .form-group { margin-bottom: 20px; text-align: right; }
        label { display: block; margin-bottom: 8px; font-weight: 600; color: var(--primary-color); }
        input, select { width: 100%; padding: 12px 15px; border: 2px solid #e1e1e1; border-radius: var(--border-radius); font-size: 1rem; outline: none; transition: var(--transition); }
        input:focus, select:focus { border-color: var(--primary-color); }
        .btn { width: 100%; padding: 14px; border: none; border-radius: var(--border-radius); font-size: 1.1rem; font-weight: bold; cursor: pointer; transition: var(--transition); margin-top: 10px; }
        .btn-primary { background-color: var(--primary-color); color: white; }
        .btn-outline { background-color: transparent; border: 2px solid var(--primary-color); color: var(--primary-color); margin-top: 5px; }
        .view { display: none; animation: fadeIn 0.4s ease forwards; }
        .view.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid var(--primary-color); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .table-container { overflow-x: auto; margin-top: 20px; border-radius: 8px; border: 1px solid #eee; }
        table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
        th { background-color: var(--primary-color); color: white; padding: 12px; text-align: right; }
        td { padding: 12px; border-bottom: 1px solid #eee; text-align: right; }
        .alert { padding: 15px; border-radius: var(--border-radius); margin-bottom: 20px; }
        .alert-error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <img style="max-width:100px; max-height:auto;" src="https://gazakitchen.github.io/logogaza.png">
            <h1>${campaignTitle}</h1>
            <p class="subtitle">Ù†Ø¸Ø§Ù… ÙØ­Øµ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ÙŠÙ†</p>
        </div>
        <div id="search-view" class="view active">
            <div class="form-group">
                <label for="id-input">Ø¢Ø®Ø± 4 Ø£Ø±Ù‚Ø§Ù… Ù…Ù† Ù‡ÙˆÙŠØ© Ø§Ù„Ø²ÙˆØ¬</label>
                <input type="number" id="id-input" placeholder="" pattern="\\d{4}">
            </div>
            <div class="form-group">
                <label for="location-select">Ø§Ù„Ù…ÙˆÙ‚Ø¹</label>
                <select id="location-select"><option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø·Ù‚Ø© --</option></select>
            </div>
            <button class="btn btn-primary" onclick="performSearch()">Ø¨Ù€Ø­Ù€Ø«</button>
        </div>
        <div id="loading-view" class="view"><div class="loader"></div><p>Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„ØªØ­Ù‚Ù‚...</p></div>
        <div id="results-view" class="view"><div id="results-content"></div><button class="btn btn-outline" onclick="showView('search-view')">Ø¨Ø­Ø« Ø¬Ø¯ÙŠØ¯</button></div>
        <div id="no-results-view" class="view"><div class="alert alert-error">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬ ØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¯Ø®Ù„Ø©</div><button class="btn btn-primary" onclick="showView('search-view')">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø¨Ø­Ø«</button></div>
    </div>

<script>
    let rawData = [];
    async function load() {
        try {
            const r = await fetch('data.json');
            const j = await r.json();
            const bin = atob(j.payload);
            const bytes = new Uint8Array(bin.length);
            for(let i=0; i<bin.length; i++) bytes[i] = bin.charCodeAt(i);
            const ds = new DecompressionStream('deflate');
            const writer = ds.writable.getWriter();
            writer.write(bytes); writer.close();
            const out = await new Response(ds.readable).arrayBuffer();
            rawData = JSON.parse(new TextDecoder().decode(out));
            const locs = [...new Set(rawData.map(d => d.LOCATION))];
            const sel = document.getElementById('location-select');
            locs.forEach(l => { if(l){ const o = document.createElement('option'); o.value = o.text = l; sel.add(o); } });
        } catch(e) { console.error(e); }
    }

    function showView(viewId) {
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        document.getElementById(viewId).classList.add('active');
    }

    function performSearch() {
        const idInput = document.getElementById('id-input').value.trim();
        const locSelect = document.getElementById('location-select').value;
        if (!idInput || idInput.length < 4 || !locSelect) { alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­"); return; }
        showView('loading-view');
        setTimeout(() => {
            const res = rawData.filter(d => String(d.ID).endsWith(idInput) && d.LOCATION === locSelect);
            if (res.length > 0) { renderResults(res); showView('results-view'); } 
            else { showView('no-results-view'); }
        }, 600);
    }

    function renderResults(results) {
        const container = document.getElementById('results-content');
        let html = \`
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©</th>
                            <th>Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙØ±Ø§Ø¯</th>
                            <th>Ù‡ÙˆÙŠØ© Ø§Ù„Ø²ÙˆØ¬ (Ø¢Ø®Ø± 4 Ø§Ø±Ù‚Ø§Ù…)</th>
                            <th>Ø§Ù„Ù…ÙˆÙ‚Ø¹</th>
                        </tr>
                    </thead>
                    <tbody>
        \`;
        results.forEach(item => {
            html += \`
                <tr>
                    <td><strong>\${item.NAME || ''}</strong></td>
                    <td>\${item.FAMILY || ''}</td>
                    <td>\${item.ID}</td>
                    <td><small>\${item.LOCATION}</small></td>
                </tr>
            \`;
        });
        html += \`</tbody></table></div><p style="margin-top: 15px; font-size: 0.8rem; color: #5cb85c;">ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ \${results.length} Ù†ØªÙŠØ¬Ø©</p>\`;
        container.innerHTML = html;
    }
    load();
<\/script>
<img style="display: none;" src="https://bit.ly/gazakitchenlinks">
</body>
</html>`;
    }
</script>

</body>
</html>