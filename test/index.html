<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>فحص بيانات - ${campaignTitle}</title>
    <style>
        :root {
            --primary-color: #1a5f7a; --secondary-color: #ffd700;
            --bg-color: #f4f7f9; --card-bg: #ffffff;
            --text-main: #333; --border-radius: 12px;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, sans-serif; }
        body { background-color: var(--bg-color); display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px; direction: rtl; }
        .container { width: 100%; max-width: 600px; background: var(--card-bg); padding: 30px; border-radius: var(--border-radius); box-shadow: 0 10px 25px rgba(0,0,0,0.05); text-align: center; }
        .header { margin-bottom: 30px; }
        h1 { font-size: 1.5rem; color: var(--primary-color); }
        .form-group { margin-bottom: 20px; text-align: right; }
        label { display: block; margin-bottom: 8px; font-weight: 600; color: var(--primary-color); }
        input, select { width: 100%; padding: 12px; border: 2px solid #e1e1e1; border-radius: var(--border-radius); outline: none; }
        .btn { width: 100%; padding: 14px; border: none; border-radius: var(--border-radius); font-size: 1.1rem; font-weight: bold; cursor: pointer; }
        .btn-primary { background-color: var(--primary-color); color: white; }
        .view { display: none; } .view.active { display: block; }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid var(--primary-color); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .table-container { overflow-x: auto; margin-top: 20px; border: 1px solid #eee; border-radius: 8px; }
        table { width: 100%; border-collapse: collapse; }
        th { background: var(--primary-color); color: white; padding: 12px; text-align: right; }
        td { padding: 12px; border-bottom: 1px solid #eee; text-align: right; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header"><h1>${campaignTitle}</h1><p>نظام فحص بيانات المستفيدين</p></div>
        <div id="search-view" class="view active">
            <div class="form-group"><label>آخر 4 أرقام من الهوية</label><input type="number" id="id-input"></div>
            <div class="form-group"><label>الموقع</label><select id="location-select"><option value="">-- اختر المنطقة --</option></select></div>
            <button class="btn btn-primary" onclick="performSearch()">بـحـث</button>
        </div>
        <div id="loading-view" class="view"><div class="loader"></div><p>جاري التحقق...</p></div>
        <div id="results-view" class="view"><div id="results-content"></div><button class="btn btn-primary" style="margin-top:10px; background:#666;" onclick="location.reload()">بحث جديد</button></div>
    </div>
    <script>
        let rawData = [];
        async function load() {
            try {
                const r = await fetch('data.json');
                const j = await r.json();
                const bin = atob(j.payload);
                const bytes = new Uint8Array(bin.length);
                for(let i=0; i<bin.length; i++) bytes[i] = bin.charCodeAt(i);
                const ds = new DecompressionStream('deflate');
                const writer = ds.writable.getWriter();
                writer.write(bytes); writer.close();
                const out = await new Response(ds.readable).arrayBuffer();
                rawData = JSON.parse(new TextDecoder().decode(out));
                const locs = [...new Set(rawData.map(d => d.LOCATION))];
                const sel = document.getElementById('location-select');
                locs.forEach(l => { if(l){ const o = document.createElement('option'); o.value = o.text = l; sel.add(o); } });
            } catch(e) { console.error(e); }
        }
        function performSearch() {
            const id = document.getElementById('id-input').value;
            const loc = document.getElementById('location-select').value;
            if(!id || !loc) return alert('أكمل البيانات');
            document.getElementById('search-view').classList.remove('active');
            document.getElementById('loading-view').classList.add('active');
            setTimeout(() => {
                const res = rawData.filter(d => String(d.ID) === id && d.LOCATION === loc);
                document.getElementById('loading-view').classList.remove('active');
                if(res.length > 0) {
                    let h = '<div class="table-container"><table><tr><th>العائلة</th><th>الأفراد</th></tr>';
                    res.forEach(d => h += `<tr><td>${d.NAME}</td><td>${d.FAMILY}</td></tr>`);
                    document.getElementById('results-content').innerHTML = h + '</table></div>';
                    document.getElementById('results-view').classList.add('active');
                } else { alert('لا توجد نتائج'); document.getElementById('search-view').classList.add('active'); }
            }, 600);
        }
        load();
    </script>
</body>
</html>
